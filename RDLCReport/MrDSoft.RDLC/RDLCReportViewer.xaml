<UserControl
    x:Class="TimePunch.Rdlc.RdlcReportViewer"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.modernwpf.com/2019"
    Width="800"
    Height="500"
    Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
    BorderThickness="1"
    mc:Ignorable="d">

    <!--
        CREDIT : 2013-2018 Derek Tremblay (abbaye), 2013 Martin Savard
        https://github.com/abbaye/RDLCPrinter
    -->

    <UserControl.Resources>
        <ResourceDictionary>
            <RoutedUICommand x:Key="OpenPrintDialog" />
        </ResourceDictionary>
    </UserControl.Resources>


    <UserControl.CommandBindings>
        <CommandBinding Command="{StaticResource OpenPrintDialog}" Executed="CommandBinding_Executed" />

    </UserControl.CommandBindings>
    <UserControl.InputBindings>
        <KeyBinding
            Key="P"
            Command="{StaticResource OpenPrintDialog}"
            Modifiers="Control" />
    </UserControl.InputBindings>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Border BorderBrush="Black" BorderThickness="0,0,0,1">
            <ui:CommandBar DefaultLabelPosition="Collapsed" HorizontalAlignment="Stretch" x:Name="ToolBarRow">
                <ui:CommandBar.PrimaryCommands>

                    <!-- refresh -->
                    <ui:AppBarButton x:Name="TBBRefresh"
                                     Click="CmdRefresh_Click"
                                     Icon="Refresh"
                                     Label="Refresh"
                                     IsEnabled="False"/>
                    <ui:AppBarSeparator/>

                    <!-- print -->
                    <ui:AppBarButton x:Name="TBBPrintWithProperties"
                                     Click="TBBPrintWithProperties_Click"
                                     Icon="Print"
                                     Label="Print"
                                     IsEnabled="False"/>

                    <!-- export -->
                    <ui:AppBarElementContainer VerticalAlignment="Center">
                        <ui:SplitButton 
                            x:Name="ExportMenu"
                            IsEnabled="False"
                            Click="ExportMenu_Click"
                            Background="{Binding ElementName=TBBPrint, Path=Background}">
                            <ui:SplitButton.Content>
                                <Viewbox>
                                    <ui:FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xEA90;" Foreground="{DynamicResource SystemControlPageTextBaseHighBrush}" ToolTip="Export"/>
                                </Viewbox>
                            </ui:SplitButton.Content>
                            <ui:SplitButton.Flyout>
                                <ui:MenuFlyout Placement="BottomEdgeAlignedLeft">

                                    <MenuItem Header="Adobe PDF" 
                                              Click="ExportDefault_Click">
                                        <MenuItem.Icon>
                                            <ui:FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xEA90;"/>
                                        </MenuItem.Icon>
                                    </MenuItem>

                                    <MenuItem Header="Microsoft Word" 
                                              Click="MenuItemWord_Click">
                                        <MenuItem.Icon>
                                            <ui:PathIcon Data="M 28.875 0 C 28.855469 0.0078125 28.832031 0.0195313 28.8125 0.03125 L 0.8125 5.34375 C 0.335938 5.433594 -0.0078125 5.855469 0 6.34375 L 0 43.65625 C -0.0078125 44.144531 0.335938 44.566406 0.8125 44.65625 L 28.8125 49.96875 C 29.101563 50.023438 29.402344 49.949219 29.632813 49.761719 C 29.859375 49.574219 29.996094 49.296875 30 49 L 30 44 L 47 44 C 48.09375 44 49 43.09375 49 42 L 49 8 C 49 6.90625 48.09375 6 47 6 L 30 6 L 30 1 C 30.003906 0.710938 29.878906 0.4375 29.664063 0.246094 C 29.449219 0.0546875 29.160156 -0.0351563 28.875 0 Z M 28 2.1875 L 28 6.6875 C 27.941406 6.882813 27.941406 7.085938 28 7.28125 L 28 42.8125 C 27.972656 42.945313 27.972656 43.085938 28 43.21875 L 28 47.8125 L 2 42.84375 L 2 7.15625 Z M 30 8 L 47 8 L 47 42 L 30 42 L 30 37 L 44 37 L 44 35 L 30 35 L 30 29 L 44 29 L 44 27 L 30 27 L 30 22 L 44 22 L 44 20 L 30 20 L 30 15 L 44 15 L 44 13 L 30 13 Z M 4.625 15.65625 L 8.4375 34.34375 L 12.1875 34.34375 L 14.65625 22.375 C 14.769531 21.824219 14.875 21.101563 14.9375 20.25 L 14.96875 20.25 C 14.996094 21.023438 15.058594 21.75 15.1875 22.375 L 17.59375 34.34375 L 21.21875 34.34375 L 25.0625 15.65625 L 21.75 15.65625 L 19.75 28.125 C 19.632813 28.828125 19.558594 29.53125 19.53125 30.21875 L 19.5 30.21875 C 19.433594 29.339844 19.367188 28.679688 19.28125 28.21875 L 16.90625 15.65625 L 13.40625 15.65625 L 10.78125 28.0625 C 10.613281 28.855469 10.496094 29.582031 10.46875 30.25 L 10.40625 30.25 C 10.367188 29.355469 10.308594 28.625 10.21875 28.09375 L 8.1875 15.65625 Z"/>
                                        </MenuItem.Icon>
                                    </MenuItem>

                                    <MenuItem Header="Microsoft Excel" 
                                              Click="MenuItemExcel_Click">
                                        <MenuItem.Icon>
                                            <ui:PathIcon Data="M 28.875 0 C 28.855469 0.0078125 28.832031 0.0195313 28.8125 0.03125 L 0.8125 5.34375 C 0.335938 5.433594 -0.0078125 5.855469 0 6.34375 L 0 43.65625 C -0.0078125 44.144531 0.335938 44.566406 0.8125 44.65625 L 28.8125 49.96875 C 29.101563 50.023438 29.402344 49.949219 29.632813 49.761719 C 29.859375 49.574219 29.996094 49.296875 30 49 L 30 44 L 47 44 C 48.09375 44 49 43.09375 49 42 L 49 8 C 49 6.90625 48.09375 6 47 6 L 30 6 L 30 1 C 30.003906 0.710938 29.878906 0.4375 29.664063 0.246094 C 29.449219 0.0546875 29.160156 -0.0351563 28.875 0 Z M 28 2.1875 L 28 6.53125 C 27.867188 6.808594 27.867188 7.128906 28 7.40625 L 28 42.8125 C 27.972656 42.945313 27.972656 43.085938 28 43.21875 L 28 47.8125 L 2 42.84375 L 2 7.15625 Z M 30 8 L 47 8 L 47 42 L 30 42 L 30 37 L 34 37 L 34 35 L 30 35 L 30 29 L 34 29 L 34 27 L 30 27 L 30 22 L 34 22 L 34 20 L 30 20 L 30 15 L 34 15 L 34 13 L 30 13 Z M 36 13 L 36 15 L 44 15 L 44 13 Z M 6.6875 15.6875 L 12.15625 25.03125 L 6.1875 34.375 L 11.1875 34.375 L 14.4375 28.34375 C 14.664063 27.761719 14.8125 27.316406 14.875 27.03125 L 14.90625 27.03125 C 15.035156 27.640625 15.160156 28.054688 15.28125 28.28125 L 18.53125 34.375 L 23.5 34.375 L 17.75 24.9375 L 23.34375 15.6875 L 18.65625 15.6875 L 15.6875 21.21875 C 15.402344 21.941406 15.199219 22.511719 15.09375 22.875 L 15.0625 22.875 C 14.898438 22.265625 14.710938 21.722656 14.5 21.28125 L 11.8125 15.6875 Z M 36 20 L 36 22 L 44 22 L 44 20 Z M 36 27 L 36 29 L 44 29 L 44 27 Z M 36 35 L 36 37 L 44 37 L 44 35 Z"/>
                                        </MenuItem.Icon>
                                    </MenuItem>

                                    <MenuItem Header="Image PNG" 
                                              Click="MenuItemPNG_Click">
                                        <MenuItem.Icon>
                                            <ui:PathIcon Data="M 7 2 L 7 48 L 43 48 L 43 15.414063 L 29.410156 2 Z M 9 4 L 28 4 L 28 17 L 41 17 L 41 46 L 9 46 Z M 30 5.390625 L 39.734375 15 L 30 15 Z M 33.5 21.332031 C 32.457031 21.335938 31.609375 22.15625 31.609375 23.167969 C 31.613281 24.179688 32.457031 25 33.5 25 C 34.542969 25 35.386719 24.179688 35.390625 23.167969 C 35.390625 22.15625 34.542969 21.335938 33.5 21.332031 Z M 21.167969 24 C 20.835938 23.988281 20.519531 24.136719 20.324219 24.40625 L 12.863281 34.488281 C 12.640625 34.792969 12.605469 35.195313 12.773438 35.53125 C 12.945313 35.871094 13.289063 36.082031 13.667969 36.082031 L 28.425781 36.082031 C 28.449219 36.082031 28.472656 36.082031 28.496094 36.082031 C 28.5 36.082031 28.5 36.082031 28.503906 36.082031 L 35.015625 36 C 35.398438 35.996094 35.742188 35.769531 35.90625 35.421875 C 36.066406 35.074219 36.015625 34.667969 35.777344 34.371094 L 29.269531 26.386719 C 29.078125 26.148438 28.785156 26.011719 28.480469 26.015625 C 28.164063 26.023438 27.871094 26.175781 27.6875 26.429688 L 25.554688 29.363281 L 21.9375 24.410156 C 21.753906 24.164063 21.472656 24.011719 21.167969 24 Z M 21.125 26.6875 L 24.753906 31.660156 C 24.757813 31.667969 24.761719 31.671875 24.765625 31.675781 L 26.523438 34.082031 L 15.652344 34.082031 Z M 28.539063 28.65625 L 32.917969 34.027344 L 29 34.078125 L 26.796875 31.0625 Z"/>
                                        </MenuItem.Icon>
                                    </MenuItem>

                                </ui:MenuFlyout>
                            </ui:SplitButton.Flyout>
                        </ui:SplitButton>
                    </ui:AppBarElementContainer>

                    <ui:AppBarSeparator/>

                    <!-- zoom -->
                    <ui:AppBarElementContainer VerticalAlignment="Center">
                        <StackPanel
                            x:Name="ZoomInfoStackPanel"
                            Orientation="Horizontal"
                            Visibility="Visible">
                            <TextBlock VerticalAlignment="Center" Margin="6">Zoom:</TextBlock>
                            <TextBlock
                                x:Name="ZoomValueTextBloc"
                                Margin="6"
                                VerticalAlignment="Center"/>
                            <TextBlock VerticalAlignment="Center" Margin="6">%</TextBlock>
                        </StackPanel>
                    </ui:AppBarElementContainer>

                    <ui:AppBarElementContainer VerticalAlignment="Center">
                        <ui:SplitButton 
                            x:Name="ZoomPopupButton"
                            Click="ZoomPopupButton_Click"
                            IsEnabled="False"
                            Background="{Binding ElementName=TBBPrint, Path=Background}">
                            <ui:SplitButton.Content>
                                <Viewbox>
                                    <ui:SymbolIcon Symbol="Zoom" ToolTip="Zoom"></ui:SymbolIcon>
                                </Viewbox>
                            </ui:SplitButton.Content>
                            <ui:SplitButton.Flyout>
                                <ui:Flyout Placement="Bottom">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"></ColumnDefinition>
                                            <ColumnDefinition Width="Auto"></ColumnDefinition>
                                        </Grid.ColumnDefinitions>

                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"></RowDefinition>
                                            <RowDefinition Height="Auto"></RowDefinition>
                                            <RowDefinition Height="Auto"></RowDefinition>
                                            <RowDefinition Height="Auto"></RowDefinition>
                                            <RowDefinition Height="Auto"></RowDefinition>
                                            <RowDefinition Height="Auto"></RowDefinition>
                                        </Grid.RowDefinitions>

                                        <!-- Sizing -->
                                        <Slider
                                            Grid.Row="1" Grid.RowSpan="5" Grid.Column="0"
                                            Maximum="250"
                                            Minimum="50"
                                            Orientation="Vertical"
                                            Value="100"
                                            ValueChanged="UpdateZoomText"
                                            TickFrequency="5"
                                            TickPlacement="BottomRight"
                                            x:Name="ZoomSlider"/>

                                        <!-- Zoom 250 -->
                                        <Button Grid.Row="1" Grid.Column="1" 
                                                Background="{Binding ElementName=TBBPrint, Path=Background}"
                                                Click="PerCent250Button_Click"
                                                x:Name="PerCent250Button">
                                            <Button.Content>
                                                <StackPanel Orientation="Horizontal">
                                                    <ui:SymbolIcon Symbol="ZoomIn"></ui:SymbolIcon>
                                                    <TextBlock Text="250%"></TextBlock>
                                                </StackPanel>
                                            </Button.Content>
                                        </Button>

                                        <!-- Zoom 200 -->
                                        <Button Grid.Row="2" Grid.Column="1" 
                                                Background="{Binding ElementName=TBBPrint, Path=Background}"
                                                Click="PerCent200Button_Click"
                                                x:Name="PerCent200Button">
                                            <Button.Content>
                                                <StackPanel Orientation="Horizontal">
                                                    <ui:SymbolIcon Symbol="ZoomIn"></ui:SymbolIcon>
                                                    <TextBlock Text="200%"></TextBlock>
                                                </StackPanel>
                                            </Button.Content>
                                        </Button>

                                        <!-- Zoom 150 -->
                                        <Button Grid.Row="3" Grid.Column="1" 
                                                Background="{Binding ElementName=TBBPrint, Path=Background}"
                                                Click="PerCent150Button_Click"
                                                x:Name="PerCent150Button">
                                            <Button.Content>
                                                <StackPanel Orientation="Horizontal">
                                                    <ui:SymbolIcon Symbol="ZoomIn"></ui:SymbolIcon>
                                                    <TextBlock Text="150%"></TextBlock>
                                                </StackPanel>
                                            </Button.Content>
                                        </Button>

                                        <!-- Zoom 100 -->
                                        <Button Grid.Row="4" Grid.Column="1" 
                                                Background="{Binding ElementName=TBBPrint, Path=Background}"
                                                Click="PerCent100Button_Click"
                                                x:Name="PerCent100Button">
                                            <Button.Content>
                                                <StackPanel Orientation="Horizontal">
                                                    <ui:SymbolIcon Symbol="Zoom"></ui:SymbolIcon>
                                                    <TextBlock Text="100%"></TextBlock>
                                                </StackPanel>
                                            </Button.Content>
                                        </Button>

                                        <!-- Zoom 50 -->
                                        <Button Grid.Row="5" Grid.Column="1" 
                                                Background="{Binding ElementName=TBBPrint, Path=Background}"
                                                Click="PerCent50Button_Click"
                                                x:Name="PerCent50Button">
                                            <Button.Content>
                                                <StackPanel Orientation="Horizontal">
                                                    <ui:SymbolIcon Symbol="ZoomOut"></ui:SymbolIcon>
                                                    <TextBlock Text="50%"></TextBlock>
                                                </StackPanel>
                                            </Button.Content>
                                        </Button>

                                    </Grid>
                                </ui:Flyout>
                            </ui:SplitButton.Flyout>
                        </ui:SplitButton>
                    </ui:AppBarElementContainer>

                    <ui:AppBarSeparator x:Name="PagerSeparator"/>

                    <!-- paging -->
                    <ui:AppBarButton x:Name="FirstImage"
                                     Click="FirstImage_Click"
                                     Icon="Back"
                                     Label="First"
                                     Visibility="Visible"
                                     IsEnabled="true"/>

                    <ui:AppBarButton x:Name="PreviousImage"
                                     Click="PreviousImage_Click"
                                     Icon="Previous"
                                     Label="Previous"
                                     Visibility="Visible"
                                     IsEnabled="true"/>

                    <ui:AppBarElementContainer VerticalAlignment="Center">
                        <ui:NumberBox
                            x:Name="PageSpinner"
                            Value="1"
                            ValueChanged="OnSpinnerChanged"
                            SpinButtonPlacementMode="Hidden"
                            Minimum="1"
                            SmallChange="1"
                            LargeChange="10" />
                    </ui:AppBarElementContainer>

                    <ui:AppBarButton x:Name="NextImage"
                                     Click="NextImage_Click"
                                     Icon="Next"
                                     Label="Next"
                                     Visibility="Visible"
                                     IsEnabled="true"/>

                    <ui:AppBarButton x:Name="LastImage"
                                     Click="LastImage_Click"
                                     Icon="Forward"
                                     Label="Last"
                                     Visibility="Visible"
                                     IsEnabled="true"/>

                </ui:CommandBar.PrimaryCommands>
            </ui:CommandBar>
        </Border>

        <!-- Image -->
        <ScrollViewer
            x:Name="ImageScrollViewer"
            Grid.Row="1"
            PreviewMouseWheel="ZoomByMouseWheel"
            HorizontalScrollBarVisibility="Auto"
            VerticalScrollBarVisibility="Auto">
            <ui:ThemeShadowChrome
                IsShadowEnabled="True"
                HorizontalAlignment="Center"
                Depth="32"
                Focusable="False"
                x:Name="ImgBorber"
                VerticalAlignment="Center">
                <Image
                    x:Name="PreviewImage"
                    Focusable="False"
                    RenderOptions.BitmapScalingMode="HighQuality"
                    RenderTransformOrigin="0.5,0.5">
                </Image>

                <ui:ThemeShadowChrome.LayoutTransform>
                    <TransformGroup>
                        <ScaleTransform ScaleX="0.01" ScaleY="0.01" />
                        <ScaleTransform>
                            <ScaleTransform.ScaleX>
                                <Binding
                                        ElementName="ZoomSlider"
                                        Mode="OneWay"
                                        Path="Value" />
                            </ScaleTransform.ScaleX>
                            <ScaleTransform.ScaleY>
                                <Binding
                                        ElementName="ZoomSlider"
                                        Mode="OneWay"
                                        Path="Value" />
                            </ScaleTransform.ScaleY>
                        </ScaleTransform>
                    </TransformGroup>
                    </ui:ThemeShadowChrome.LayoutTransform>

            </ui:ThemeShadowChrome>
        </ScrollViewer>
    </Grid>
</UserControl>
